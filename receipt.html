<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>YELLOW BASKET ‚Äî Receipt</title>
<link rel="icon" href="assets/img/yellow-basket-logo.png"/>
<style>
html,body{margin:0;min-height:100%;background:#eee;font-family:monospace;color:#111}
.paper{width:360px;margin:40px auto;padding:18px;background:#fff;border:1px solid #ccc;border-radius:6px;box-shadow:0 8px 24px rgba(0,0,0,.12)}
.header{text-align:center}
.header img{width:72px}
h1{margin:4px 0;font-size:16px}
.line{border-bottom:1px dashed #bbb;margin:10px 0}
.items{margin-top:8px}
.item{display:flex;justify-content:space-between}
.btn{display:inline-block;padding:8px 12px;border-radius:6px;background:#ffd54f;border:none;font-weight:800;cursor:pointer;margin-top:12px}
.footer{text-align:center;color:#666;margin-top:10px;font-size:12px}
</style>
</head>
<body>
  <div class="paper" id="paper">
    <div class="header">
      <img src="assets/img/yellow-basket-logo.png" alt="logo">
      <h1>YELLOW BASKET - NETOPIA SUKI MARKET</h1>
      <div style="font-size:12px;color:#666">2ND FLOOR ‚Ä¢ SAN PEDRO BRANCH</div>
      <div style="font-size:12px;color:#666">SERVER: ESC Biennale - Tambay - Low Bandwidth Dreams - British Council</div>
    </div>

    <div class="line"></div>
    <div id="receiptBody"></div>

    <div class="line"></div>
    <div id="totalLine" style="text-align:right;font-weight:800">Total: ‚Ç±0.00</div>

    <div style="display:flex;gap:8px;margin-top:12px;justify-content:center">
      <button id="saveTxt" class="btn">üßæ Download .txt Receipt</button>
      <a href="index.html" class="btn" style="background:#eee;text-decoration:none;color:#111">‚Üê Continue</a>
    </div>

    <div class="footer">CD-R King approved peripherals only</div>
  </div>

<script>
function getLastOrder(){ try{ return JSON.parse(localStorage.getItem('yb_last_order')||'null'); }catch(e){ return null; } }
function render(){
  const order = getLastOrder();
  const body = document.getElementById('receiptBody');
  const totalLine = document.getElementById('totalLine');
  if(!order){ body.innerHTML = '<p style="color:#777">No recent order found.</p>'; return; }
  let html = `<div>Order ID: ${order.id}</div><div>Name: ${order.name}</div><div>Address: ${order.addr}</div><div>Payment: ${order.method}</div><div>Date: ${new Date(order.ts).toLocaleString()}</div><div class="line"></div>`;
  order.items.forEach(it=>{
    html += `<div class="item"><div>${it.name} x${it.qty||1}</div><div>‚Ç±${((it.price||0)*(it.qty||1)).toFixed(2)}</div></div>`;
  });
  body.innerHTML = html;
  totalLine.textContent = `Total: ‚Ç±${(order.total||0).toFixed(2)}`;
}
render();

document.getElementById('saveTxt').addEventListener('click', ()=>{
  const order = getLastOrder();
  if(!order){ alert('No order to save.'); return; }
  const lines = [];
  lines.push('YELLOW BASKET - NETOPIA SUKI MARKET');
  lines.push('2ND FLOOR ‚Ä¢ SAN PEDRO BRANCH');
  lines.push('SERVER: ESC Biennale - Tambay - Low Bandwidth Dreams - British Council');
  lines.push('----------------------------------------');
  lines.push(`Order ID: ${order.id}`);
  lines.push(`Name: ${order.name}`);
  lines.push(`Address: ${order.addr}`);
  lines.push(`Payment: ${order.method}`);
  lines.push(`Date: ${new Date(order.ts).toLocaleString()}`);
  lines.push('');
  lines.push('Items:');
  (order.items||[]).forEach(it=>{
    lines.push(`- ${it.name} x${it.qty||1}  ‚Ç±${((it.price||0)*(it.qty||1)).toFixed(2)}`);
  });
  lines.push('');
  lines.push(`Total: ‚Ç±${(order.total||0).toFixed(2)}`);
  lines.push('');
  lines.push('Thank you for supporting the imaginary economy.');
  const blob = new Blob([lines.join('\n')], {type:'text/plain'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = `yellowbasket_receipt_${order.id}.txt`; a.click();
  URL.revokeObjectURL(url);
  // small print sound
  try{ const ac = new (window.AudioContext||window.webkitAudioContext)(); const n=ac.createBufferSource(); const b=ac.createBuffer(1,ac.sampleRate*0.5,ac.sampleRate); const d=b.getChannelData(0); for(let i=0;i<d.length;i++) d[i]=(Math.random()*2-1)*0.6; n.buffer=b; const g=ac.createGain(); g.gain.value=0.03; n.connect(g); g.connect(ac.destination); n.start(); }catch(e){}
});
</script>
</body>
</html>
